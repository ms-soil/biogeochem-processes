---
title: "Oil palm decomposition"
author: "Marcus Schmidt"
date: "8 November 2019"
output: github_document
---

### Background
This study was done on oil-palm plantations in Indonesia on two differen soil types.

### The code
Let's fist load our library. It is the tidyverse library, which includes useful tools for data handling and visualization, i.e. the ggplot 2 package.
```{r libraries, echo = T, results='hide', message=F, warning=F}
library("tidyverse")
```

Next, I am going to load my data from the .txt file I created and look at the first 5 observations too see what's going on:
```{r data-loading, echo = T, results = 'hide'}
DATA=read.table("data/schmidt-nut-data.txt",h=T)
head(DATA)
```

You may also want to try
```{r data-viewing, echo = T, results = 'hide', eval = F}
View(DATA)
```
to see the whole data set.

We now want to look at the first soil type (Clay Acrisol) at the first site, so we create a subset like this, using the pipe (%>%) from the tidyverse package. Then we check if this really worked.

```{r filtering, echo = T}
DATA<-DATA%>%filter(Plot == "C1")
unique(DATA$Plot)
```

The next part is key! We are plotting our Data - days and mass, fit an exponential cuve and retrieve k, our decomposition rate:


```{r fitting-and-plotting, echo = T}
xx <- seq(0,605, length=1500)
plot(DATA$Mass_g 
     ~ DATA$d)
y <- DATA$Mass_g
x <- DATA$d
fit <- nls(y ~ (50.81 * 2.718^(-k * x)), start=list(k=0.00001))
lines(xx, predict(fit, data.frame(x=xx)), col="red", lwd=2, lty=1)
summary(fit)
```

In the output above, we are given the k and some information on how well it fits the observed data.

We made the plot using the basic plot package in R. However, in order to get a much nicer plot, I recommend using the ggplot 2 package. It's already included in the tidyverse library we installed earlier. 

We first define the functin including k, which we get from above and define what data we want to use:

```{r function-defining, echo = T, }
func1<- function(x) {50.81 * 2.718^(-0.0052707 * x)}
dat1 = data.frame(x = DATA$d, y = DATA$Mass_g)
```

Now we define the plot:
```{r gg-plot-code, echo = T, results = 'hide', eval = F}
g1 <- ggplot(dat1,aes(x,y)) +
  xlim(0,400) +
  ylim(0,60) +
  geom_point(show.legend = FALSE) +
  ggtitle("Leaf mass decline on Clay Aricsol 1") +
  xlab("days") +
  ylab("remaining mass in g") +
  stat_function(fun = func1, xlim=c(0,400), col = "red")
g1
```

And this is what we get:
```{r gg-plot-output, echo = F}
g1 <- ggplot(dat1,aes(x,y)) +
  xlim(0,400) +
  ylim(0,60) +
  geom_point(show.legend = FALSE) +
  ggtitle("Leaf mass decline on Clay Aricsol 1") +
  xlab("days") +
  ylab("remaining mass in g") +
  stat_function(fun = func1, xlim=c(0,400), col = "red")
g1
```

To save your plot in a folder called figs within your project, we can use the cowplot package.
```{r saving, echo = T, results = 'hide', message=F, warning=F}
library(cowplot)
ggsave("figs/oil-palm-decomp.png", plot = g1, width = 10, height = 10)
```

